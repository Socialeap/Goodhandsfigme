globalThis.offlineWidgets = globalThis.offlineWidgets || {};
      globalThis.offlineWidgets["@saruman/jigsaw@0.0.0"] = {
        manifest: "{\n  \"scriptId\": \"@saruman/jigsaw\",\n  \"scope\": \"item\",\n  \"allowedAnimations\": [\n    \"in\",\n    \"out\"\n  ],\n  \"allowedInteractivityActions\": [],\n  \"version\": \"0.0.0\",\n  \"configSchema\": {\n    \"title\": {\n      \"en\": \"Image Jigsaw Puzzle Widget\",\n      \"es\": \"Widget de puzzle de imagen\",\n      \"it\": \"Widget puzzle di immagini\",\n      \"de\": \"Bild-Puzzle-Widget\",\n      \"pt-br\": \"Widget de Quebra-cabeça de Imagem\",\n      \"fr\": \"Widget puzzle d'image\"\n    },\n    \"fields\": [\n      {\n        \"type\": \"image\",\n        \"name\": \"puzzleImage\",\n        \"defaultValue\": {\n          \"$type\": \"image\",\n          \"source\": null\n        },\n        \"label\": {\n          \"en\": \"Puzzle Image\",\n          \"es\": \"Imagen del puzzle\",\n          \"it\": \"Immagine del puzzle\",\n          \"de\": \"Puzzle-Bild\",\n          \"pt-br\": \"Imagem do quebra-cabeça\",\n          \"fr\": \"Image du puzzle\"\n        },\n        \"help\": {\n          \"en\": \"Upload the image that will be cut into pieces for the puzzle.\",\n          \"es\": \"Sube la imagen que se dividirá en piezas para el puzzle.\",\n          \"it\": \"Carica l'immagine che verrà suddivisa in pezzi per il puzzle.\",\n          \"de\": \"Lade das Bild hoch, das in Teile für das Puzzle geschnitten wird.\",\n          \"pt-br\": \"Envie a imagem que será dividida em peças para o quebra-cabeça.\",\n          \"fr\": \"Téléversez l'image qui sera découpée en pièces pour le puzzle.\"\n        },\n        \"canBeNull\": false,\n        \"objectFit\": \"contain\"\n      },\n      {\n        \"type\": \"dropdown\",\n        \"name\": \"gridSize\",\n        \"defaultValue\": \"3\",\n        \"label\": {\n          \"en\": \"Puzzle Grid Size\",\n          \"es\": \"Tamaño de la cuadrícula del puzzle\",\n          \"it\": \"Dimensione della griglia del puzzle\",\n          \"de\": \"Größe des Puzzle-Rasters\",\n          \"pt-br\": \"Tamanho da grade do quebra-cabeça\",\n          \"fr\": \"Taille de la grille du puzzle\"\n        },\n        \"help\": {\n          \"en\": \"Select the number of rows and columns for the puzzle pieces (e.g., '3' for 3x3 = 9 pieces).\",\n          \"es\": \"Selecciona el número de filas y columnas para las piezas del puzzle (por ejemplo, '3' para 3x3 = 9 piezas).\",\n          \"it\": \"Seleziona il numero di righe e colonne per i pezzi del puzzle (es. '3' per 3x3 = 9 pezzi).\",\n          \"de\": \"Wähle die Anzahl der Reihen und Spalten für die Puzzle-Teile (z. B. '3' für 3x3 = 9 Teile).\",\n          \"pt-br\": \"Selecione o número de linhas e colunas para as peças do quebra-cabeça (por exemplo, '3' para 3x3 = 9 peças).\",\n          \"fr\": \"Sélectionnez le nombre de lignes et de colonnes pour les pièces du puzzle (par ex. '3' pour 3x3 = 9 pièces).\"\n        },\n        \"options\": [\n          {\n            \"value\": \"2\",\n            \"label\": {\n              \"en\": \"2x2 (4 pieces)\",\n              \"es\": \"2x2 (4 piezas)\",\n              \"it\": \"2x2 (4 pezzi)\",\n              \"de\": \"2x2 (4 Teile)\",\n              \"pt-br\": \"2x2 (4 peças)\",\n              \"fr\": \"2x2 (4 pièces)\"\n            }\n          },\n          {\n            \"value\": \"3\",\n            \"label\": {\n              \"en\": \"3x3 (9 pieces)\",\n              \"es\": \"3x3 (9 piezas)\",\n              \"it\": \"3x3 (9 pezzi)\",\n              \"de\": \"3x3 (9 Teile)\",\n              \"pt-br\": \"3x3 (9 peças)\",\n              \"fr\": \"3x3 (9 pièces)\"\n            }\n          },\n          {\n            \"value\": \"4\",\n            \"label\": {\n              \"en\": \"4x4 (16 pieces)\",\n              \"es\": \"4x4 (16 piezas)\",\n              \"it\": \"4x4 (16 pezzi)\",\n              \"de\": \"4x4 (16 Teile)\",\n              \"pt-br\": \"4x4 (16 peças)\",\n              \"fr\": \"4x4 (16 pièces)\"\n            }\n          },\n          {\n            \"value\": \"5\",\n            \"label\": {\n              \"en\": \"5x5 (25 pieces)\",\n              \"es\": \"5x5 (25 piezas)\",\n              \"it\": \"5x5 (25 pezzi)\",\n              \"de\": \"5x5 (25 Teile)\",\n              \"pt-br\": \"5x5 (25 peças)\",\n              \"fr\": \"5x5 (25 pièces)\"\n            }\n          }\n        ]\n      },\n      {\n        \"type\": \"colorInput\",\n        \"name\": \"selectionColor\",\n        \"defaultValue\": \"#6B29FF\",\n        \"label\": {\n          \"en\": \"Selection Color\",\n          \"es\": \"Color de selección\",\n          \"it\": \"Colore di selezione\",\n          \"de\": \"Auswahlfarbe\",\n          \"pt-br\": \"Cor de seleção\",\n          \"fr\": \"Couleur de sélection\"\n        },\n        \"help\": {\n          \"en\": \"Choose the color used for highlighting selected pieces and drag interactions.\",\n          \"es\": \"Elige el color que se usará para resaltar las piezas seleccionadas y las interacciones de arrastre.\",\n          \"it\": \"Scegli il colore usato per evidenziare i pezzi selezionati e le interazioni di trascinamento.\",\n          \"de\": \"Wähle die Farbe, die zum Hervorheben ausgewählter Teile und bei Drag-Interaktionen verwendet wird.\",\n          \"pt-br\": \"Escolha a cor usada para destacar peças selecionadas e interações de arrastar.\",\n          \"fr\": \"Choisissez la couleur utilisée pour mettre en évidence les pièces sélectionnées et les interactions de glisser.\"\n        }\n      },\n      {\"type\": \"separator\" },\n      {\n        \"type\": \"switch\",\n        \"name\": \"showReloadButton\",\n        \"defaultValue\": false,\n        \"label\": {\n          \"en\": \"Show Reload Button\",\n          \"es\": \"Mostrar botón de recargar\",\n          \"it\": \"Mostra pulsante di ricarica\",\n          \"de\": \"Lade-/Neustart-Button anzeigen\",\n          \"pt-br\": \"Mostrar botão de recarregar\",\n          \"fr\": \"Afficher le bouton de rechargement\"\n        },\n        \"help\": {\n          \"en\": \"Enable a reload button that allows users to restart the puzzle with pieces reshuffled.\",\n          \"es\": \"Activa un botón de recarga que permite a los usuarios reiniciar el puzzle con las piezas barajadas.\",\n          \"it\": \"Attiva un pulsante di ricarica che permette agli utenti di riavviare il puzzle con i pezzi rimescolati.\",\n          \"de\": \"Aktiviere einen Neustart-Button, mit dem Benutzer das Puzzle mit neu durchmischten Teilen neu starten können.\",\n          \"pt-br\": \"Ative um botão de recarregar que permite aos usuários reiniciar o quebra-cabeça com as peças embaralhadas.\",\n          \"fr\": \"Activez un bouton de rechargement permettant aux utilisateurs de redémarrer le puzzle avec les pièces mélangées.\"\n        }\n      },\n      {\n        \"type\": \"conditional\",\n        \"if\": \"showReloadButton\",\n        \"label\": {\n          \"en\": \"Reload Button Configuration\",\n          \"es\": \"Configuración del botón de recarga\",\n          \"it\": \"Configurazione del pulsante di ricarica\",\n          \"de\": \"Konfiguration des Neustart-Buttons\",\n          \"pt-br\": \"Configuração do botão de recarregar\",\n          \"fr\": \"Configuration du bouton de rechargement\"\n        },\n        \"then\": [\n          {\n            \"type\": \"colorInput\",\n            \"name\": \"reloadButtonColor\",\n            \"label\": {\n              \"en\": \"Button Background Color\",\n              \"es\": \"Color de fondo del botón\",\n              \"it\": \"Colore di sfondo del pulsante\",\n              \"de\": \"Hintergrundfarbe des Buttons\",\n              \"pt-br\": \"Cor de fundo do botão\",\n              \"fr\": \"Couleur de fond du bouton\"\n            },\n            \"help\": {\n              \"en\": \"Choose the background color for the reload button.\",\n              \"es\": \"Elige el color de fondo para el botón de recarga.\",\n              \"it\": \"Scegli il colore di sfondo per il pulsante di ricarica.\",\n              \"de\": \"Wähle die Hintergrundfarbe für den Neustart-Button.\",\n              \"pt-br\": \"Escolha a cor de fundo para o botão de recarregar.\",\n              \"fr\": \"Choisissez la couleur de fond pour le bouton de rechargement.\"\n            },\n            \"defaultValue\": \"#6B29FF\"\n          },\n          {\n            \"type\": \"colorInput\",\n            \"name\": \"reloadButtonTextColor\",\n            \"label\": {\n              \"en\": \"Button Text Color\",\n              \"es\": \"Color del texto del botón\",\n              \"it\": \"Colore del testo del pulsante\",\n              \"de\": \"Textfarbe des Buttons\",\n              \"pt-br\": \"Cor do texto do botão\",\n              \"fr\": \"Couleur du texte du bouton\"\n            },\n            \"help\": {\n              \"en\": \"Choose the text color for the reload button.\",\n              \"es\": \"Elige el color del texto para el botón de recarga.\",\n              \"it\": \"Scegli il colore del testo per il pulsante di ricarica.\",\n              \"de\": \"Wähle die Textfarbe für den Neustart-Button.\",\n              \"pt-br\": \"Escolha a cor do texto para o botão de recarregar.\",\n              \"fr\": \"Choisissez la couleur du texte pour le bouton de rechargement.\"\n            },\n            \"defaultValue\": \"#ffffff\"\n          }\n        ]\n      },\n      {\"type\": \"separator\" },\n      {\n        \"type\": \"textInput\",\n        \"name\": \"completionActionDelayTime\",\n        \"defaultValue\": \"0\",\n        \"label\": {\n          \"en\": \"Completion Action Delay (seconds)\",\n          \"es\": \"Tiempo de espera de la acción de completado (segundos)\",\n          \"it\": \"Ritardo dell'azione di completamento (secondi)\",\n          \"de\": \"Verzögerung der Abschlussaktion (Sekunden)\",\n          \"pt-br\": \"Atraso da ação de conclusão (segundos)\",\n          \"fr\": \"Délai de l'action de fin (secondes)\"\n        },\n        \"help\": {\n          \"en\": \"Set a delay in seconds before triggering the completion action.\",\n          \"es\": \"Establece un retraso en segundos antes de activar la acción de completado.\",\n          \"it\": \"Imposta un ritardo in secondi prima di attivare l'azione di completamento.\",\n          \"de\": \"Lege eine Verzögerung in Sekunden fest, bevor die Abschlussaktion ausgelöst wird.\",\n          \"pt-br\": \"Defina um atraso em segundos antes de acionar a ação de conclusão.\",\n          \"fr\": \"Définissez un délai en secondes avant de déclencher l'action de fin.\"\n        },\n        \"canBeNull\": true,\n        \"validations\": [\n          {\n            \"regexp\": \"^([0-9]|10)$\"\n          }\n        ],\n        \"validationErrorMessage\": {\n          \"en\": \"Must be a number between 0 and 10.\",\n          \"es\": \"Debe ser un número entre 0 y 10.\",\n          \"it\": \"Deve essere un numero tra 0 e 10.\",\n          \"de\": \"Muss eine Zahl zwischen 0 und 10 sein.\",\n          \"pt-br\": \"Deve ser um número entre 0 e 10.\",\n          \"fr\": \"Doit être un nombre entre 0 et 10.\"\n        }\n      },\n      {\n        \"type\": \"action\",\n        \"name\": \"completionAction\",\n        \"defaultValue\": {\n          \"$type\": \"action\",\n          \"action\": null\n        },\n        \"label\": {\n          \"en\": \"On Puzzle Completion\",\n          \"es\": \"Al completar el puzzle\",\n          \"it\": \"Al completamento del puzzle\",\n          \"de\": \"Bei Puzzle-Abschluss\",\n          \"pt-br\": \"Ao concluir o quebra-cabeça\",\n          \"fr\": \"À la fin du puzzle\"\n        },\n        \"help\": {\n          \"en\": \"Configure an action to run when the user successfully reassembles the puzzle.\",\n          \"es\": \"Configura una acción para ejecutar cuando el usuario recomponga correctamente el puzzle.\",\n          \"it\": \"Configura un'azione da eseguire quando l'utente ricompone correttamente il puzzle.\",\n          \"de\": \"Konfiguriere eine Aktion, die ausgeführt wird, wenn der Benutzer das Puzzle erfolgreich zusammensetzt.\",\n          \"pt-br\": \"Configure uma ação para ser executada quando o usuário remontar o quebra-cabeça com sucesso.\",\n          \"fr\": \"Configurez une action à exécuter lorsque l'utilisateur reconstitue correctement le puzzle.\"\n        },\n        \"canBeNull\": true\n      },\n      {\n        \"type\": \"action\",\n        \"name\": \"correctMoveAction\",\n        \"defaultValue\": {\n          \"$type\": \"action\",\n          \"action\": null\n        },\n        \"label\": {\n          \"en\": \"On Correct Move\",\n          \"es\": \"Al movimiento correcto\",\n          \"it\": \"Alla mossa corretta\",\n          \"de\": \"Bei richtigem Zug\",\n          \"pt-br\": \"Ao movimento correto\",\n          \"fr\": \"Lors d'un déplacement correct\"\n        },\n        \"help\": {\n          \"en\": \"Configure an action to run when the user makes a correct move (places a piece in its correct position).\",\n          \"es\": \"Configura una acción para ejecutar cuando el usuario hace un movimiento correcto (coloca una pieza en su posición correcta).\",\n          \"it\": \"Configura un'azione da eseguire quando l'utente fa una mossa corretta (posiziona un pezzo nella posizione giusta).\",\n          \"de\": \"Konfiguriere eine Aktion, die ausgeführt wird, wenn der Benutzer einen richtigen Zug macht (ein Teil an die richtige Stelle setzt).\",\n          \"pt-br\": \"Configure uma ação para ser executada quando o usuário fizer um movimento correto (colocar uma peça na posição correta).\",\n          \"fr\": \"Configurez une action à exécuter lorsque l'utilisateur effectue un mouvement correct (place une pièce à sa position).\"\n        },\n        \"canBeNull\": true\n      },\n      {\n        \"type\": \"action\",\n        \"name\": \"incorrectMoveAction\",\n        \"defaultValue\": {\n          \"$type\": \"action\",\n          \"action\": null\n        },\n        \"label\": {\n          \"en\": \"On Incorrect Move\",\n          \"es\": \"Al movimiento incorrecto\",\n          \"it\": \"Alla mossa errata\",\n          \"de\": \"Bei falschem Zug\",\n          \"pt-br\": \"Ao movimento incorreto\",\n          \"fr\": \"Lors d'un déplacement incorrect\"\n        },\n        \"help\": {\n          \"en\": \"Configure an action to run when the user makes an incorrect move (swaps pieces but neither goes to correct position).\",\n          \"es\": \"Configura una acción para ejecutar cuando el usuario hace un movimiento incorrecto (intercambia piezas pero ninguna queda en la posición correcta).\",\n          \"it\": \"Configura un'azione da eseguire quando l'utente compie una mossa errata (scambia pezzi ma nessuno finisce nella posizione corretta).\",\n          \"de\": \"Konfiguriere eine Aktion, die ausgeführt wird, wenn der Benutzer einen falschen Zug macht (Teile vertauscht, aber keines landet an der richtigen Position).\",\n          \"pt-br\": \"Configure uma ação para ser executada quando o usuário fizer um movimento incorreto (trocar peças mas nenhuma ficar na posição correta).\",\n          \"fr\": \"Configurez une action à exécuter lorsque l'utilisateur effectue un déplacement incorrect (échange des pièces mais aucune n'est à la bonne position).\"\n        },\n        \"canBeNull\": true\n      },\n      {\n        \"type\": \"action\",\n        \"name\": \"pieceSelectAction\",\n        \"defaultValue\": {\n          \"$type\": \"action\",\n          \"action\": null\n        },\n        \"label\": {\n          \"en\": \"On Piece Selection\",\n          \"es\": \"Al seleccionar una pieza\",\n          \"it\": \"Alla selezione del pezzo\",\n          \"de\": \"Bei Auswahl eines Teils\",\n          \"pt-br\": \"Ao selecionar uma peça\",\n          \"fr\": \"Lors de la sélection d'une pièce\"\n        },\n        \"help\": {\n          \"en\": \"Configure an action to run when the user selects a puzzle piece by clicking on it.\",\n          \"es\": \"Configura una acción para ejecutar cuando el usuario selecciona una pieza del puzzle haciendo clic en ella.\",\n          \"it\": \"Configura un'azione da eseguire quando l'utente seleziona un pezzo del puzzle facendo clic su di esso.\",\n          \"de\": \"Konfiguriere eine Aktion, die ausgeführt wird, wenn der Benutzer ein Puzzleteil durch Anklicken auswählt.\",\n          \"pt-br\": \"Configure uma ação para ser executada quando o usuário selecionar uma peça do quebra-cabeça ao clicar nela.\",\n          \"fr\": \"Configurez une action à exécuter lorsque l'utilisateur sélectionne une pièce du puzzle en cliquant dessus.\"\n        },\n        \"canBeNull\": true\n      },\n      {\n        \"type\": \"action\",\n        \"name\": \"correctPieceClickAction\",\n        \"defaultValue\": {\n          \"$type\": \"action\",\n          \"action\": null\n        },\n        \"label\": {\n          \"en\": \"On Correct Piece Click\",\n          \"es\": \"Al hacer clic en pieza correcta\",\n          \"it\": \"Al clic sul pezzo corretto\",\n          \"de\": \"Beim Klick auf korrektes Teil\",\n          \"pt-br\": \"Ao clicar em peça correta\",\n          \"fr\": \"Au clic sur une pièce déjà correcte\"\n        },\n        \"help\": {\n          \"en\": \"Configure an action to run when the user tries to select a piece that is already in its correct position.\",\n          \"es\": \"Configura una acción para ejecutar cuando el usuario intenta seleccionar una pieza que ya está en su posición correcta.\",\n          \"it\": \"Configura un'azione da eseguire quando l'utente prova a selezionare un pezzo che è già nella posizione corretta.\",\n          \"de\": \"Konfiguriere eine Aktion, die ausgeführt wird, wenn der Benutzer versucht, ein Teil auszuwählen, das bereits an der richtigen Position ist.\",\n          \"pt-br\": \"Configure uma ação para ser executada quando o usuário tentar selecionar uma peça que já está na posição correta.\",\n          \"fr\": \"Configurez une action à exécuter lorsque l'utilisateur tente de sélectionner une pièce qui est déjà à sa bonne position.\"\n        },\n        \"canBeNull\": true\n      }\n    ]\n  }\n}\n",
        index: "<!doctype html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <script\n      type=\"text/javascript\"\n      src=\"static/js/geniallycode.js\"\n    ></script>\n    <style>\n      :root {\n        --selection-color: #6b29ff;\n        --color-dark-text: rgb(18, 18, 18);\n      }\n\n      html,\n      body {\n        margin: 0;\n        padding: 0;\n        width: 100%;\n        min-height: 100vh;\n        box-sizing: border-box;\n        display: flex;\n        flex-direction: column;\n        color: var(--color-dark-text);\n      }\n\n      #app {\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        position: relative;\n        overflow: hidden;\n      }\n\n      .puzzle-container {\n        display: grid;\n        position: relative;\n        border-radius: 8px;\n        max-width: 100%;\n        max-height: 100%;\n        gap: 1px;\n        transition: all 0.3s ease-in-out;\n      }\n\n      .puzzle-piece {\n        background-size: cover;\n        background-position: center;\n        cursor: grab;\n        border: 1px solid rgba(255, 255, 255, 0.5);\n        box-sizing: border-box;\n        transition:\n          transform 0.2s ease-out,\n          box-shadow 0.2s ease-out;\n        user-select: none;\n        touch-action: manipulation;\n      }\n\n      .puzzle-piece:not(.correct):hover {\n        transform: scale(1.03);\n        box-shadow: 0 0 15px color-mix(in srgb, var(--selection-color) 50%, transparent);\n        z-index: 10;\n      }\n\n      .puzzle-piece.dragging {\n        opacity: 0.6;\n        border: 2px dashed var(--selection-color);\n        box-shadow: 0 0 20px color-mix(in srgb, var(--selection-color) 70%, transparent);\n        transform: scale(1.05);\n        z-index: 20;\n      }\n\n      .puzzle-piece.drag-over {\n        box-shadow: inset 0 0 10px var(--selection-color);\n        transform: scale(0.98);\n      }\n\n      .puzzle-piece.correct {\n        cursor: default;\n        border: 1px solid rgba(18, 18, 18, 0.3);\n        box-shadow: inset 0 0 5px rgba(18, 18, 18, 0.1);\n        opacity: 1;\n        animation: correct-snap 0.3s ease-out;\n      }\n\n      .puzzle-piece.correct:hover {\n        transform: none;\n        box-shadow: inset 0 0 5px rgba(18, 18, 18, 0.1);\n      }\n\n      @keyframes correct-snap {\n        0% {\n          transform: scale(1.05);\n        }\n        70% {\n          transform: scale(0.98);\n        }\n        100% {\n          transform: scale(1);\n        }\n      }\n\n      @keyframes bounce-in {\n        0% {\n          transform: translate(-50%, -50%) scale(0);\n          opacity: 0;\n        }\n        50% {\n          transform: translate(-50%, -50%) scale(1.1);\n          opacity: 1;\n        }\n        70% {\n          transform: translate(-50%, -50%) scale(0.95);\n        }\n        100% {\n          transform: translate(-50%, -50%) scale(1);\n        }\n      }\n\n      .loading-state {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        text-align: center;\n        color: var(--color-dark-text);\n        padding: 2rem;\n      }\n\n      .spinner {\n        width: 60px;\n        height: 60px;\n        margin-bottom: 1rem;\n        display: inline-block;\n        animation: spin 1s linear infinite;\n      }\n\n      .spinner svg {\n        width: 100%;\n        height: 100%;\n      }\n\n      @keyframes spin {\n        0% {\n          transform: rotate(0deg);\n        }\n        100% {\n          transform: rotate(360deg);\n        }\n      }\n\n      /* Editor mode styles - disable animations and interactions */\n      .editor-mode .puzzle-container {\n        transition: none;\n      }\n\n      .editor-mode .puzzle-piece {\n        transition: none;\n        cursor: default;\n        animation: none;\n      }\n\n      .editor-mode .puzzle-piece:not(.correct):hover {\n        transform: none;\n        box-shadow: none;\n        z-index: auto;\n      }\n\n      .editor-mode .puzzle-piece.correct {\n        animation: none;\n      }\n\n      .editor-mode .puzzle-piece.correct:hover {\n        transform: none;\n        box-shadow: inset 0 0 5px rgba(18, 18, 18, 0.1);\n      }\n\n      /* Selected piece styles */\n      .puzzle-piece.selected {\n        border: 3px solid var(--selection-color);\n        transform: scale(1.05);\n        z-index: 15;\n      }\n\n      .puzzle-piece.clickable {\n        cursor: pointer;\n      }\n\n      .puzzle-piece.drop-target {\n        border: 2px dashed var(--selection-color);\n        background-color: color-mix(in srgb, var(--selection-color) 10%, transparent);\n      }\n\n      /* Reload button styles */\n      .reload-button {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        border: none;\n        cursor: pointer;\n        display: none;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.3s ease-out;\n        z-index: 100;\n        opacity: 0;\n        animation: none;\n      }\n\n      .reload-button.show {\n        display: flex;\n        opacity: 1;\n        animation: bounce-in 0.6s ease-out;\n      }\n\n      .reload-button:hover {\n        transform: translate(-50%, -50%) scale(1.1);\n      }\n\n      .reload-button:active {\n        transform: translate(-50%, -50%) scale(0.95);\n      }\n\n      .reload-button svg {\n        width: 28px;\n        height: 28px;\n        transition: transform 3s ease;\n      }\n\n      /* Hide reload button in editor mode */\n      .editor-mode .reload-button {\n        display: none;\n      }\n    </style>\n\n    <!-- Automatically Generated Tailwind CSS -->\n    <style>\n      *,\n      ::backdrop,\n      :after,\n      :before {\n        --tw-border-spacing-x: 0;\n        --tw-border-spacing-y: 0;\n        --tw-translate-x: 0;\n        --tw-translate-y: 0;\n        --tw-rotate: 0;\n        --tw-skew-x: 0;\n        --tw-skew-y: 0;\n        --tw-scale-x: 1;\n        --tw-scale-y: 1;\n        --tw-pan-x: ;\n        --tw-pan-y: ;\n        --tw-pinch-zoom: ;\n        --tw-scroll-snap-strictness: proximity;\n        --tw-gradient-from-position: ;\n        --tw-gradient-via-position: ;\n        --tw-gradient-to-position: ;\n        --tw-ordinal: ;\n        --tw-slashed-zero: ;\n        --tw-numeric-figure: ;\n        --tw-numeric-spacing: ;\n        --tw-numeric-fraction: ;\n        --tw-ring-inset: ;\n        --tw-ring-offset-width: 0px;\n        --tw-ring-offset-color: #fff;\n        --tw-ring-color: #3b82f680;\n        --tw-ring-offset-shadow: 0 0 #0000;\n        --tw-ring-shadow: 0 0 #0000;\n        --tw-shadow: 0 0 #0000;\n        --tw-shadow-colored: 0 0 #0000;\n        --tw-blur: ;\n        --tw-brightness: ;\n        --tw-contrast: ;\n        --tw-grayscale: ;\n        --tw-hue-rotate: ;\n        --tw-invert: ;\n        --tw-saturate: ;\n        --tw-sepia: ;\n        --tw-drop-shadow: ;\n        --tw-backdrop-blur: ;\n        --tw-backdrop-brightness: ;\n        --tw-backdrop-contrast: ;\n        --tw-backdrop-grayscale: ;\n        --tw-backdrop-hue-rotate: ;\n        --tw-backdrop-invert: ;\n        --tw-backdrop-opacity: ;\n        --tw-backdrop-saturate: ;\n        --tw-backdrop-sepia: ;\n        --tw-contain-size: ;\n        --tw-contain-layout: ;\n        --tw-contain-paint: ;\n        --tw-contain-style: ;\n      } /*! tailwindcss v3.4.18 | MIT License | https://tailwindcss.com*/\n      *,\n      :after,\n      :before {\n        box-sizing: border-box;\n        border: 0 solid #e5e7eb;\n      }\n      :after,\n      :before {\n        --tw-content: \"\";\n      }\n      :host,\n      html {\n        line-height: 1.5;\n        -webkit-text-size-adjust: 100%;\n        -moz-tab-size: 4;\n        -o-tab-size: 4;\n        tab-size: 4;\n        -webkit-tap-highlight-color: transparent;\n      }\n      body {\n        margin: 0;\n        line-height: inherit;\n      }\n      hr {\n        height: 0;\n        color: inherit;\n        border-top-width: 1px;\n      }\n      abbr:where([title]) {\n        -webkit-text-decoration: underline dotted;\n        text-decoration: underline dotted;\n      }\n      h1,\n      h2,\n      h3,\n      h4,\n      h5,\n      h6 {\n        font-size: inherit;\n        font-weight: inherit;\n      }\n      a {\n        color: inherit;\n        text-decoration: inherit;\n      }\n      b,\n      strong {\n        font-weight: bolder;\n      }\n      code,\n      kbd,\n      pre,\n      samp {\n        font-family:\n          ui-monospace,\n          SFMono-Regular,\n          Menlo,\n          Monaco,\n          Consolas,\n          Liberation Mono,\n          Courier New,\n          monospace;\n        font-feature-settings: normal;\n        font-variation-settings: normal;\n        font-size: 1em;\n      }\n      small {\n        font-size: 80%;\n      }\n      sub,\n      sup {\n        font-size: 75%;\n        line-height: 0;\n        position: relative;\n        vertical-align: initial;\n      }\n      sub {\n        bottom: -0.25em;\n      }\n      sup {\n        top: -0.5em;\n      }\n      table {\n        text-indent: 0;\n        border-color: inherit;\n        border-collapse: collapse;\n      }\n      button,\n      input,\n      optgroup,\n      select,\n      textarea {\n        font-family: inherit;\n        font-feature-settings: inherit;\n        font-variation-settings: inherit;\n        font-size: 100%;\n        font-weight: inherit;\n        line-height: inherit;\n        letter-spacing: inherit;\n        color: inherit;\n        margin: 0;\n        padding: 0;\n      }\n      button,\n      select {\n        text-transform: none;\n      }\n      button,\n      input:where([type=\"button\"]),\n      input:where([type=\"reset\"]),\n      input:where([type=\"submit\"]) {\n        -webkit-appearance: button;\n        background-color: initial;\n        background-image: none;\n      }\n      :-moz-focusring {\n        outline: auto;\n      }\n      :-moz-ui-invalid {\n        box-shadow: none;\n      }\n      progress {\n        vertical-align: initial;\n      }\n      ::-webkit-inner-spin-button,\n      ::-webkit-outer-spin-button {\n        height: auto;\n      }\n      [type=\"search\"] {\n        -webkit-appearance: textfield;\n        outline-offset: -2px;\n      }\n      ::-webkit-search-decoration {\n        -webkit-appearance: none;\n      }\n      ::-webkit-file-upload-button {\n        -webkit-appearance: button;\n        font: inherit;\n      }\n      summary {\n        display: list-item;\n      }\n      blockquote,\n      dd,\n      dl,\n      figure,\n      h1,\n      h2,\n      h3,\n      h4,\n      h5,\n      h6,\n      hr,\n      p,\n      pre {\n        margin: 0;\n      }\n      fieldset {\n        margin: 0;\n      }\n      fieldset,\n      legend {\n        padding: 0;\n      }\n      menu,\n      ol,\n      ul {\n        list-style: none;\n        margin: 0;\n        padding: 0;\n      }\n      dialog {\n        padding: 0;\n      }\n      textarea {\n        resize: vertical;\n      }\n      input::-moz-placeholder,\n      textarea::-moz-placeholder {\n        opacity: 1;\n        color: #9ca3af;\n      }\n      input::placeholder,\n      textarea::placeholder {\n        opacity: 1;\n        color: #9ca3af;\n      }\n      [role=\"button\"],\n      button {\n        cursor: pointer;\n      }\n      :disabled {\n        cursor: default;\n      }\n      audio,\n      canvas,\n      embed,\n      iframe,\n      img,\n      object,\n      svg,\n      video {\n        display: block;\n        vertical-align: middle;\n      }\n      img,\n      video {\n        max-width: 100%;\n        height: auto;\n      }\n      [hidden]:where(:not([hidden=\"until-found\"])) {\n        display: none;\n      }\n      .container {\n        width: 100%;\n      }\n      @media (min-width: 640px) {\n        .container {\n          max-width: 640px;\n        }\n      }\n      @media (min-width: 768px) {\n        .container {\n          max-width: 768px;\n        }\n      }\n      @media (min-width: 1024px) {\n        .container {\n          max-width: 1024px;\n        }\n      }\n      @media (min-width: 1280px) {\n        .container {\n          max-width: 1280px;\n        }\n      }\n      @media (min-width: 1536px) {\n        .container {\n          max-width: 1536px;\n        }\n      }\n      .static {\n        position: static;\n      }\n      .absolute {\n        position: absolute;\n      }\n      .relative {\n        position: relative;\n      }\n      .flex {\n        display: flex;\n      }\n      .grid {\n        display: grid;\n      }\n      .hidden {\n        display: none;\n      }\n      .transform {\n        transform: translate(var(--tw-translate-x), var(--tw-translate-y))\n          rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y))\n          scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));\n      }\n      .resize {\n        resize: both;\n      }\n      .border {\n        border-width: 1px;\n      }\n      .text-xl {\n        font-size: 1.25rem;\n        line-height: 1.75rem;\n      }\n      .font-semibold {\n        font-weight: 600;\n      }\n      .text-red-500 {\n        --tw-text-opacity: 1;\n        color: rgb(239 68 68 / var(--tw-text-opacity, 1));\n      }\n      .transition {\n        transition-property:\n          color, background-color, border-color, text-decoration-color, fill, stroke,\n          opacity, box-shadow, transform, filter, -webkit-backdrop-filter;\n        transition-property:\n          color, background-color, border-color, text-decoration-color, fill, stroke,\n          opacity, box-shadow, transform, filter, backdrop-filter;\n        transition-property:\n          color, background-color, border-color, text-decoration-color, fill, stroke,\n          opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter;\n        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n        transition-duration: 0.15s;\n      }\n    </style>\n  </head>\n  <body>\n    <div id=\"app\">\n      <div id=\"loading-state\" class=\"loading-state\">\n        <div class=\"spinner\">\n          <svg width=\"60\" height=\"60\" viewBox=\"0 0 50 50\">\n            <circle\n              cx=\"25\"\n              cy=\"25\"\n              r=\"20\"\n              fill=\"none\"\n              stroke=\"var(--selection-color)\"\n              stroke-width=\"3\"\n              stroke-linecap=\"round\"\n              stroke-dasharray=\"60 120\"\n            ></circle>\n          </svg>\n        </div>\n      </div>\n    </div>\n\n    <script>\n      let puzzlePiecesData = [];\n      let draggedItem = null;\n      let puzzleContainer = null;\n      let currentGridSize = 3;\n      let completionAction = null;\n      let correctMoveAction = null;\n      let incorrectMoveAction = null;\n      let pieceSelectAction = null;\n      let correctPieceClickAction = null;\n      let totalPieces = 0;\n      let correctPiecesCount = 0;\n      let currentImage = null;\n      let appMode = '';\n      let selectedPiece = null;\n      let touchDragItem = null;\n      let touchStartPos = { x: 0, y: 0 };\n      let isDragging = false;\n      let showReloadButton = null;\n      let reloadButtonColor = '';\n      let reloadButtonTextColor = '';\n      let selectionColor = '';\n      let completionActionDelayTime = null;\n\n      function shuffleArray(array) {\n        for (let i = array.length - 1; i > 0; i--) {\n          const j = Math.floor(Math.random() * (i + 1));\n          [array[i], array[j]] = [array[j], array[i]];\n        }\n        return array;\n      }\n\n      // Utility functions for common operations\n      function isValidDragTarget(piece) {\n        return piece && !piece.classList.contains('correct');\n      }\n\n      function isEditorMode() {\n        return appMode === 'editor';\n      }\n\n      function getPuzzlePieceFromElement(element) {\n        return element ? element.closest('.puzzle-piece') : null;\n      }\n\n      function clearAllDragOverStates() {\n        if (!puzzleContainer) {\n          return;\n        }\n        const pieces = Array.from(puzzleContainer.children);\n        for (const piece of pieces) {\n          piece.classList.remove('drag-over');\n        }\n      }\n\n      function addDragOverState(targetPiece, draggedPiece) {\n        clearAllDragOverStates();\n        if (isValidDragTarget(targetPiece) && targetPiece !== draggedPiece) {\n          targetPiece.classList.add('drag-over');\n        }\n      }\n\n      function cleanupDragState(draggedElement) {\n        if (draggedElement) {\n          draggedElement.classList.remove('dragging');\n        }\n        clearAllDragOverStates();\n      }\n\n      function canSwapPieces(piece1, piece2) {\n        return (\n          piece1 &&\n          piece2 &&\n          piece1 !== piece2 &&\n          isValidDragTarget(piece1) &&\n          isValidDragTarget(piece2)\n        );\n      }\n\n      function reloadPuzzle() {\n        if (isEditorMode()) {\n          return;\n        }\n\n        // Hide the reload button immediately\n        hideReloadButton();\n\n        // Clear selected piece\n        deselectPiece();\n\n        // Reshuffle the pieces\n        if (puzzlePiecesData && puzzlePiecesData.length > 0) {\n          puzzlePiecesData = shuffleArray([...puzzlePiecesData]);\n\n          // Reset correct pieces count\n          correctPiecesCount = 0;\n\n          // Re-render the pieces in new positions\n          const pieces = Array.from(puzzleContainer.children);\n          pieces.forEach((piece, index) => {\n            const newPieceData = puzzlePiecesData[index];\n            piece.dataset.id = newPieceData.id;\n            piece.dataset.correctPos = newPieceData.correctPositionIndex;\n            piece.style.backgroundImage = `url(${newPieceData.imageUrl})`;\n            piece.classList.remove('correct');\n            piece.draggable = appMode !== 'editor';\n          });\n\n          // Check if puzzle is completed after reshuffling (unlikely but possible)\n          checkCompletion();\n        }\n      }\n\n      function createReloadButton() {\n        if (!showReloadButton || isEditorMode()) {\n          return null;\n        }\n\n        const button = document.createElement('button');\n        button.className = 'reload-button';\n        button.id = 'reload-button';\n        button.style.backgroundColor = reloadButtonColor;\n        button.onclick = reloadPuzzle;\n        button.innerHTML = `\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"28px\" viewBox=\"0 -960 960 960\" width=\"28px\" fill=\"${reloadButtonTextColor}\">\n                  <path d=\"M480-80q-75 0-140.5-28.5t-114-77q-48.5-48.5-77-114T120-440h80q0 117 81.5 198.5T480-160q117 0 198.5-81.5T760-440q0-117-81.5-198.5T480-720h-6l62 62-56 58-160-160 160-160 56 58-62 62h6q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-440q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T480-80Z\"/>\n                  </svg>\n      `;\n        return button;\n      }\n\n      function displayReloadButton() {\n        const button = document.getElementById('reload-button');\n        if (button) {\n          button.classList.add('show');\n        }\n      }\n\n      function hideReloadButton() {\n        const button = document.getElementById('reload-button');\n        if (button) {\n          button.classList.remove('show');\n        }\n      }\n\n      function checkMoveCorrectness(piece1, piece2) {\n        if (!piece1 || !piece2) {\n          return false;\n        }\n\n        const piece1CorrectPos = Number.parseInt(piece1.dataset.correctPos, 10);\n        const piece2CorrectPos = Number.parseInt(piece2.dataset.correctPos, 10);\n\n        // Get current positions in the grid\n        const pieces = Array.from(puzzleContainer.children);\n        const piece1CurrentIndex = pieces.indexOf(piece1);\n        const piece2CurrentIndex = pieces.indexOf(piece2);\n\n        // Check if either piece will be in its correct position after the swap\n        const piece1WillBeCorrect = piece2CurrentIndex === piece1CorrectPos;\n        const piece2WillBeCorrect = piece1CurrentIndex === piece2CorrectPos;\n\n        return piece1WillBeCorrect || piece2WillBeCorrect;\n      }\n\n      function handleTouchStart(e) {\n        if (isEditorMode()) {\n          return;\n        }\n\n        const touch = e.touches[0];\n        const touchedPiece = getPuzzlePieceFromElement(e.target);\n\n        if (!isValidDragTarget(touchedPiece)) {\n          return;\n        }\n\n        // Cancel any click selection when starting a touch drag\n        deselectPiece();\n\n        touchDragItem = touchedPiece;\n        touchStartPos = { x: touch.clientX, y: touch.clientY };\n        isDragging = false;\n\n        // Prevent default to avoid scrolling\n        e.preventDefault();\n      }\n\n      function handleTouchMove(e) {\n        if (!touchDragItem || isEditorMode()) {\n          return;\n        }\n\n        const touch = e.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartPos.x);\n        const deltaY = Math.abs(touch.clientY - touchStartPos.y);\n\n        // Start dragging if moved more than 10px\n        if (!isDragging && (deltaX > 10 || deltaY > 10)) {\n          isDragging = true;\n          touchDragItem.classList.add('dragging');\n\n          // Trigger piece selection action when starting to drag on touch\n          if (pieceSelectAction) {\n            genially.runAction(pieceSelectAction);\n          }\n        }\n\n        if (isDragging) {\n          // Find element under touch point\n          const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);\n          const targetPiece = getPuzzlePieceFromElement(elementBelow);\n\n          addDragOverState(targetPiece, touchDragItem);\n        }\n\n        e.preventDefault();\n      }\n\n      function handleTouchEnd(e) {\n        if (!touchDragItem || isEditorMode()) {\n          return;\n        }\n\n        if (isDragging) {\n          const touch = e.changedTouches[0];\n          const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);\n          const targetPiece = getPuzzlePieceFromElement(elementBelow);\n\n          if (canSwapPieces(touchDragItem, targetPiece)) {\n            const isCorrectMove = checkMoveCorrectness(touchDragItem, targetPiece);\n\n            swapPieces(touchDragItem, targetPiece);\n\n            // Trigger correct or incorrect move action\n            if (isCorrectMove && correctMoveAction) {\n              genially.runAction(correctMoveAction);\n            } else if (!isCorrectMove && incorrectMoveAction) {\n              genially.runAction(incorrectMoveAction);\n            }\n\n            checkCompletion();\n          }\n\n          cleanupDragState(touchDragItem);\n        } else {\n          // If no drag occurred, treat as click\n          handlePieceClick({ target: touchDragItem });\n        }\n\n        touchDragItem = null;\n        isDragging = false;\n        e.preventDefault();\n      }\n\n      function handlePieceClick(e) {\n        if (isEditorMode()) {\n          return;\n        }\n\n        const clickedPiece = getPuzzlePieceFromElement(e.target);\n\n        // Check if clicking on a correct piece\n        if (clickedPiece?.classList.contains('correct')) {\n          if (correctPieceClickAction) {\n            genially.runAction(correctPieceClickAction);\n          }\n          return;\n        }\n\n        if (!isValidDragTarget(clickedPiece)) {\n          return;\n        }\n\n        // If no piece is selected, select this one\n        if (!selectedPiece) {\n          selectedPiece = clickedPiece;\n          clickedPiece.classList.add('selected');\n\n          // Trigger piece selection action\n          if (pieceSelectAction) {\n            genially.runAction(pieceSelectAction);\n          }\n        }\n        // If clicking on the selected piece, deselect it\n        else if (selectedPiece === clickedPiece) {\n          deselectPiece();\n        }\n        // If clicking on another piece, swap them\n        else if (canSwapPieces(selectedPiece, clickedPiece)) {\n          const isCorrectMove = checkMoveCorrectness(selectedPiece, clickedPiece);\n\n          swapPieces(selectedPiece, clickedPiece);\n          deselectPiece();\n\n          // Trigger correct or incorrect move action\n          if (isCorrectMove && correctMoveAction) {\n            genially.runAction(correctMoveAction);\n          } else if (!isCorrectMove && incorrectMoveAction) {\n            genially.runAction(incorrectMoveAction);\n          }\n\n          checkCompletion();\n        }\n      }\n\n      function deselectPiece() {\n        if (selectedPiece) {\n          selectedPiece.classList.remove('selected');\n          selectedPiece = null;\n        }\n      }\n\n      function swapPieces(piece1, piece2) {\n        const parent = puzzleContainer;\n        const tempPlaceholder = document.createElement('div');\n\n        // Insert placeholder before piece1\n        parent.insertBefore(tempPlaceholder, piece1);\n        // Move piece1 to piece2's position\n        parent.insertBefore(piece1, piece2);\n        // Move piece2 to piece1's original position (where placeholder is)\n        parent.insertBefore(piece2, tempPlaceholder);\n        // Remove placeholder\n        parent.removeChild(tempPlaceholder);\n      }\n\n      function updateContainerSize() {\n        if (!puzzleContainer || !currentImage) {\n          return;\n        }\n\n        const imageWidth = currentImage.naturalWidth;\n        const imageHeight = currentImage.naturalHeight;\n        const aspectRatio = imageWidth / imageHeight;\n\n        // Calculate container dimensions to use 95%\n        const viewportWidth = window.innerWidth * 0.95;\n        const viewportHeight = window.innerHeight * 0.95;\n        let containerWidth, containerHeight;\n\n        if (aspectRatio > viewportWidth / viewportHeight) {\n          // Image is wider relative to viewport - fit to width\n          containerWidth = viewportWidth;\n          containerHeight = containerWidth / aspectRatio;\n        } else {\n          // Image is taller relative to viewport - fit to height\n          containerHeight = viewportHeight;\n          containerWidth = containerHeight * aspectRatio;\n        }\n\n        puzzleContainer.style.width = `${containerWidth}px`;\n        puzzleContainer.style.height = `${containerHeight}px`;\n      }\n\n      function checkCompletion() {\n        correctPiecesCount = 0;\n        if (!puzzleContainer) {\n          return;\n        }\n        const pieces = Array.from(puzzleContainer.children);\n        pieces.forEach((piece, index) => {\n          const correctPos = Number.parseInt(piece.dataset.correctPos, 10);\n          if (index === correctPos) {\n            piece.classList.add('correct');\n            correctPiecesCount++;\n          } else {\n            piece.classList.remove('correct');\n          }\n        });\n\n        if (correctPiecesCount === totalPieces) {\n          if (completionAction) {\n            if (completionActionDelayTime) {\n              const delayInMs = Number.parseInt(completionActionDelayTime, 10) * 1000;\n              setTimeout(() => {\n                genially.runAction(completionAction);\n              }, delayInMs);\n            } else {\n              genially.runAction(completionAction);\n            }\n          }\n          for (const piece of pieces) {\n            piece.draggable = false;\n          }\n          // Show reload button when puzzle is completed\n          if (showReloadButton) {\n            displayReloadButton();\n          }\n        } else {\n          for (const piece of pieces) {\n            if (!piece.classList.contains('correct')) {\n              piece.draggable = true;\n            }\n          }\n          // Hide reload button when puzzle is not completed\n          hideReloadButton();\n        }\n      }\n\n      function handleDragStart(e) {\n        const piece = getPuzzlePieceFromElement(e.target);\n        if (!isValidDragTarget(piece) || !e.target.draggable) {\n          e.preventDefault();\n          return;\n        }\n\n        // Cancel any click selection when starting a drag\n        deselectPiece();\n\n        // Trigger piece selection action when starting to drag\n        if (pieceSelectAction) {\n          genially.runAction(pieceSelectAction);\n        }\n\n        draggedItem = e.target;\n        e.dataTransfer.effectAllowed = 'move';\n        e.target.classList.add('dragging');\n      }\n\n      function handleDragOver(e) {\n        e.preventDefault();\n        const targetElement = getPuzzlePieceFromElement(e.target);\n        if (isValidDragTarget(targetElement) && targetElement !== draggedItem) {\n          targetElement.classList.add('drag-over');\n        }\n      }\n\n      function handleDragLeave(e) {\n        const targetElement = getPuzzlePieceFromElement(e.target);\n        if (targetElement) {\n          targetElement.classList.remove('drag-over');\n        }\n      }\n\n      function handleDrop(e) {\n        e.preventDefault();\n        const targetElement = getPuzzlePieceFromElement(e.target);\n\n        if (canSwapPieces(draggedItem, targetElement)) {\n          const isCorrectMove = checkMoveCorrectness(draggedItem, targetElement);\n\n          swapPieces(draggedItem, targetElement);\n          targetElement.classList.remove('drag-over');\n\n          // Trigger correct or incorrect move action\n          if (isCorrectMove && correctMoveAction) {\n            genially.runAction(correctMoveAction);\n          } else if (!isCorrectMove && incorrectMoveAction) {\n            genially.runAction(incorrectMoveAction);\n          }\n\n          checkCompletion();\n        }\n      }\n\n      function handleDragEnd(e) {\n        cleanupDragState(e.target);\n        draggedItem = null;\n      }\n\n      async function render(config) {\n        // Clear any selected piece when re-rendering\n        deselectPiece();\n\n        const app = document.getElementById('app');\n\n        // Apply editor mode class if in editor\n        const isEditorMode = config && config.appMode === 'editor';\n        document.body.className = isEditorMode ? 'editor-mode' : '';\n\n        app.innerHTML = `\n              <div id=\"loading-state\" class=\"loading-state\">\n                <div class=\"spinner\">\n                  <svg width=\"60\" height=\"60\" viewBox=\"0 0 50 50\">\n                    <circle cx=\"25\" cy=\"25\" r=\"20\" fill=\"none\" stroke=\"${selectionColor || 'var(--selection-color)'}\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-dasharray=\"60 120\"></circle>\n                  </svg>\n                </div>\n              </div>\n            `;\n\n        const loadingState = document.getElementById('loading-state');\n        if (!config || !config.puzzleImage || !config.puzzleImage.source) {\n          loadingState.innerHTML = `\n                <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"48px\" viewBox=\"0 -960 960 960\" width=\"48px\" fill=\"#00000\"><path d=\"M440-437ZM100-120q-24 0-42-18t-18-42v-513q0-23 18-41.5t42-18.5h147l73-87h274v60H348l-73 87H100v513h680v-414h60v414q0 24-18.5 42T780-120H100Zm680-574v-86h-86v-60h86v-87h60v87h87v60h-87v86h-60ZM439.5-267q72.5 0 121.5-49t49-121.5q0-72.5-49-121T439.5-607q-72.5 0-121 48.5t-48.5 121q0 72.5 48.5 121.5t121 49Zm0-60q-47.5 0-78.5-31.5t-31-79q0-47.5 31-78.5t78.5-31q47.5 0 79 31t31.5 78.5q0 47.5-31.5 79t-79 31.5Z\"/></svg>\n              `;\n          return;\n        }\n\n        loadingState.style.display = 'flex';\n\n        const {\n          puzzleImage,\n          gridSize: configGridSize,\n          completionAction: configCompletionAction,\n          correctMoveAction: configCorrectMoveAction,\n          incorrectMoveAction: configIncorrectMoveAction,\n          pieceSelectAction: configPieceSelectAction,\n          correctPieceClickAction: configCorrectPieceClickAction,\n          appMode: configAppMode,\n          showReloadButton: configShowReloadButton,\n          reloadButtonColor: reloadButtonColorConfig,\n          reloadButtonTextColor: reloadButtonTextConfig,\n          selectionColor: configSelectionColor,\n          completionActionDelayTime: configCompletionActionDelayTime,\n        } = config;\n        currentGridSize = Number.parseInt(configGridSize, 10) || 3;\n        completionAction = configCompletionAction;\n        correctMoveAction = configCorrectMoveAction;\n        incorrectMoveAction = configIncorrectMoveAction;\n        pieceSelectAction = configPieceSelectAction;\n        correctPieceClickAction = configCorrectPieceClickAction;\n        totalPieces = currentGridSize * currentGridSize;\n        appMode = configAppMode;\n        showReloadButton = !!configShowReloadButton;\n        reloadButtonColor = reloadButtonColorConfig;\n        reloadButtonTextColor = reloadButtonTextConfig;\n        selectionColor = configSelectionColor;\n        completionActionDelayTime = configCompletionActionDelayTime;\n\n        // Update CSS custom property for selection color\n        document.documentElement.style.setProperty('--selection-color', selectionColor);\n        const img = new Image();\n        img.crossOrigin = 'Anonymous';\n        img.src = puzzleImage.source;\n\n        img.onload = () => {\n          currentImage = img;\n          const imageWidth = img.naturalWidth;\n          const imageHeight = img.naturalHeight;\n          const aspectRatio = imageWidth / imageHeight;\n\n          // Calculate container dimensions to use 95%\n          const viewportWidth = window.innerWidth * 0.95;\n          const viewportHeight = window.innerHeight * 0.95;\n          let containerWidth, containerHeight;\n\n          if (aspectRatio > viewportWidth / viewportHeight) {\n            // Image is wider relative to viewport - fit to width\n            containerWidth = viewportWidth;\n            containerHeight = containerWidth / aspectRatio;\n          } else {\n            // Image is taller relative to viewport - fit to height\n            containerHeight = viewportHeight;\n            containerWidth = containerHeight * aspectRatio;\n          }\n\n          const pieceWidth = imageWidth / currentGridSize;\n          const pieceHeight = imageHeight / currentGridSize;\n\n          const pieces = [];\n          for (let i = 0; i < totalPieces; i++) {\n            const row = Math.floor(i / currentGridSize);\n            const col = i % currentGridSize;\n\n            const pieceCanvas = document.createElement('canvas');\n            pieceCanvas.width = pieceWidth;\n            pieceCanvas.height = pieceHeight;\n            const pieceCtx = pieceCanvas.getContext('2d');\n\n            pieceCtx.drawImage(\n              img,\n              col * pieceWidth,\n              row * pieceHeight,\n              pieceWidth,\n              pieceHeight,\n              0,\n              0,\n              pieceWidth,\n              pieceHeight,\n            );\n\n            pieces.push({\n              id: `piece-${i}`,\n              correctPositionIndex: i,\n              imageUrl: pieceCanvas.toDataURL('image/png'),\n            });\n          }\n\n          puzzlePiecesData = shuffleArray([...pieces]);\n\n          loadingState.style.display = 'none';\n\n          app.innerHTML = `\n                <div id=\"puzzle-container\" class=\"puzzle-container\"></div>\n              `;\n\n          // Add reload button if enabled\n          const reloadButton = createReloadButton();\n          if (reloadButton) {\n            app.appendChild(reloadButton);\n          }\n          puzzleContainer = document.getElementById('puzzle-container');\n          puzzleContainer.style.gridTemplateColumns = `repeat(${currentGridSize}, 1fr)`;\n          puzzleContainer.style.width = `${containerWidth}px`;\n          puzzleContainer.style.height = `${containerHeight}px`;\n\n          for (const piece of puzzlePiecesData) {\n            const pieceElement = document.createElement('div');\n            pieceElement.classList.add('puzzle-piece');\n            pieceElement.dataset.id = piece.id;\n            pieceElement.dataset.correctPos = piece.correctPositionIndex;\n            pieceElement.style.backgroundImage = `url(${piece.imageUrl})`;\n\n            if (appMode !== 'editor') {\n              pieceElement.draggable = true;\n              pieceElement.classList.add('clickable');\n\n              // Desktop drag events\n              pieceElement.addEventListener('dragstart', handleDragStart);\n              pieceElement.addEventListener('dragover', handleDragOver);\n              pieceElement.addEventListener('dragleave', handleDragLeave);\n              pieceElement.addEventListener('drop', handleDrop);\n              pieceElement.addEventListener('dragend', handleDragEnd);\n\n              // Mobile touch events\n              pieceElement.addEventListener('touchstart', handleTouchStart, {\n                passive: false,\n              });\n              pieceElement.addEventListener('touchmove', handleTouchMove, {\n                passive: false,\n              });\n              pieceElement.addEventListener('touchend', handleTouchEnd, {\n                passive: false,\n              });\n\n              // Click event listener for click-to-select functionality\n              pieceElement.addEventListener('click', handlePieceClick);\n            }\n\n            puzzleContainer.appendChild(pieceElement);\n          }\n\n          if (totalPieces === 1) {\n            const pieceElement = puzzleContainer.children[0];\n            if (pieceElement) {\n              pieceElement.classList.add('correct');\n              pieceElement.draggable = false;\n              correctPiecesCount = 1;\n            }\n          }\n          checkCompletion();\n        };\n\n        img.onerror = () => {\n          console.error('Failed to load puzzle image.');\n        };\n      }\n\n      (async () => {\n        const initialConfig = await genially.connect();\n\n        genially.on('config', newConfig => {\n          render(newConfig);\n        });\n\n        render(initialConfig);\n\n        // Add resize event listener to recalculate container size\n        window.addEventListener('resize', updateContainerSize);\n\n        // Add click outside to deselect\n        document.addEventListener('click', e => {\n          if (selectedPiece && !e.target.closest('.puzzle-piece')) {\n            deselectPiece();\n          }\n        });\n      })();\n    </script>\n  </body>\n</html>\n",
      };